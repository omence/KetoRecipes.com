@model KetoRecipies.Models.Recipe
@using Microsoft.AspNetCore.Identity
@using KetoRecipies.Data
@inject SignInManager<ApplicationUser> SignInManager
@{
    ViewData["Title"] = "Details";
}
@{
    Layout = "_Layout";
}
@if (TempData["Error"] != null)
{
    <div>
        <h2 style="color:lightgreen;"><strong>Error:</strong> @TempData["Error"].ToString()</h2>
    </div>
}
<h1 class="mt-3 mb-3">@Model.Label</h1>

<div class="container row ml-0">



    <div class="card-deck col">

        <div class="card mb-3">
            <img src="@Model.ImageUrl" class="card-img-top" />
            <div class="card-body" style="align-self:center;">
                <h2><span style="font-weight:bold;">Serves:</span> @Model.Yield | <span style="font-weight:bold;">Time to Cook:</span> @Model.TotalTime min</h2>
                <hr />
                <h3><span style="font-weight:bold;">Calories:</span> @Model.TotalCaloriesServ/Serving | <span style="font-weight:bold;">Carbs:</span> @Model.TotalCarbsServ/Serving | <span style="font-weight:bold;">Fat:</span> @Model.TotalFatServ/Serving</h3>
                <hr />
                @if (Model.VideoUrl != null)
                {
                    if (Model.VideoUrl.Contains("https://www.youtube.com/watch?v="))
                    {
                        Model.VideoUrl = Model.VideoUrl.Replace("https://www.youtube.com/watch?v=", "https://www.youtube.com/embed/");

                        <iframe width="90%" height="auto" src="@Model.VideoUrl" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    }

                    if (Model.VideoUrl.Contains("https://youtu.be/"))
                    {
                        Model.VideoUrl = Model.VideoUrl.Replace("https://youtu.be/", "https://www.youtube.com/embed/");

                        <div class="embed-responsive embed-responsive-16by9">
                            <iframe width="90%" height="auto" src="@Model.VideoUrl" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        </div>
                    }
                    <hr />
                }
                <h3 style="font-weight:bold;" class="text-left">Ingredients</h3>
                @Html.Raw(Model.Ingridients)
                <hr />
                <a id="Here"></a>
                <h3 style="font-weight:bold;" class="text-left">Instructions</h3>
                @Html.Raw(Model.Instructions)
                <hr />
                <h3 class="card-title mt-2">
                    By: @Model.Source
                </h3>
                @if (SignInManager.IsSignedIn(User))
                {
                    <a asp-action="Like" asp-route-id="@Model.ID"><i style="color:deepskyblue;" class="fa mr-3 mt-5 fa-3x fa-thumbs-up"></i></a> @Model.LikeCount
                    <a asp-action="DisLike" asp-route-id="@Model.ID"><i style="color:deepskyblue;" class="fa ml-3 mt-5 fa-3x fa-thumbs-down" aria-hidden="true"></i></a> @Model.DisLikeCount

                }
            </div>
        </div>

    </div>



</div>

<div class="container">
    <div class="card-deck">
        <div class="card card text-center mb-1 ml-0 row">
            <div class="card-body text-center parent ml-0 col-sm">
                <div class="panel-body">
                    <form asp-action="AddMainComment">
                        <input type="hidden" value="@Model.ID" name="ID" />
                        <textarea class="form-control" name="message" placeholder="write a comment..." rows="3"></textarea>
                        <br>
                        <button type="submit" class="btn btn-info pull-right">Comment</button>
                    </form>
                    <div class="clearfix"></div>
                    <a id="commentsReturn"></a>
                    <ul class="media-list">
                        @foreach (var mc in Model.Comments)
                        {
                            <hr />
                            <li class="media text-left">
                                <div class="media-body">
                                    <span class="text-muted pull-right">
                                        <small class="text-muted"></small>
                                    </span>
                                    <h5><span style="font-weight:bold;">@mc.User's Comment:</span> @mc.Message</h5>

                                </div>
                            </li>


                            @foreach (var sc in mc.SubComments)
                            {
                                
                                <li class="media text-left ml-5">
                                    <div class="media-body">
                                        <span class="text-muted pull-right">
                                            <small class="text-muted"></small>
                                        </span>
                                        <h5><span style="font-weight:bold; color:deepskyblue;">@sc.User's Reply:</span> @sc.Message</h5>
                                    </div>
                                </li>

                            }
                            <a class="reply btn border ml-0" style="color:black;">Reply</a>
                            <div class="replyForm">
                                <form asp-action="AddSubComment">
                                    <input type="hidden" value="@Model.ID" name="ID" />
                                    <input type="hidden" value="@mc.ID" name="MainCommentID" />
                                    <textarea class="form-control" name="message" placeholder="write a comment..." rows="3"></textarea>
                                    <br>
                                    <button type="submit" class="btn btn-info pull-right replyHide">Reply</button>
                                </form>
                            </div>
                        }
                    </ul>
                </div>
            </div>
        </div>

    </div>
</div>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script>
    $('.replyForm').hide();

    $('.reply').on('click', function (event) {

        $(this).next('.replyForm').show();
        $(this).hide();
    })

    $('.replyHide').on('click', function (event) {

        $('.replyForm').hide();
        $('.reply').show();
    })
  

</script>